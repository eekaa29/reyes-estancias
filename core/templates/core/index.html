{% extends 'core/base.html' %}
{% load static %}
{% block head_extra  %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
{% endblock  %}

{% block title %}Reyes Estancias ‚Äî Home{% endblock %}

{# Navbar encima de la imagen #}
{% block nav_position %}absolute inset-x-0 top-0 z-50{% endblock %}
{% block nav_colors %}bg-transparent text-white{% endblock %}
{% block menu_btn_variant %}text-white {% endblock %}

{% block content %}
  <!-- HERO con imagen de fondo -->
  <section class="relative h-[100svh] sm:min-h-[480px] grid">
    <img src="{% static 'core/img/foto-home.jpg' %}"
         alt="Hero"
         class="absolute inset-0 w-full h-full object-cover pointer-events-none">
    <!-- Oscurecedor para legibilidad -->
    <div class="absolute inset-0 bg-black/35 pointer-events-none"></div>

    <!-- Texto del hero -->
    <div class="relative z-10 self-end px-4 pb-10 pt-16 sm:pt-24">
        <h1 class=" font-bold uppercase text-white tracking-[-0.04em] p-2 text-4xl md:text-6xl lg:text-7xl">COMPRUEBA DISPONIBILIDAD</h1>
        <form action="{% url 'home' %}" method="post" class="grid grid-cols-1 sm:grid-cols-4 gap-3 bg-white/90 p-4 rounded-2xl backdrop-blur md:col-start-1 md:max-w-[70%]">
            {% csrf_token %}
            <div class="">
                {{ form.checkin }}
            </div>
            <div class="class">
                {{ form.checkout }}
            </div>
            <div class="class">
                {{ form.cant_personas }}
            </div>
            <div class="flex justify-end">
                <button class="inline-flex items-center rounded-xl bg-black px-5 py-2 font-medium text-white hover:opacity-90">Buscar</button>
            </div>
        </form>
        <div class="flex items-center w-full pt-8">
          <p class="text-white">Al reservar estoy aceptando los <a class="italic underline" href="{% url 'terminos_y_condiciones' %}">T√©rminos y Condiciones de la empresa</a></p>
          {% comment %} <div class=" w-full flex justify-end">
            <p class="uppercase font-bold tracking-[0.06em] flex justify-end text-white">(DESLIZA)</p>
          </div> {% endcomment %}
        </div>
    </div>  
    
  </section>
  <section class="px-4 py-24 bg-slate-100">
    <div class="flex flex-col">
      <h2 class=" flex justify-start text-black font-bold text-4xl md:text-6xl lg:text-7xl md:max-w-16 pb-3 tracking-[-0.04em]">HOSPEDAJE DE REYES</h2>
      <p class="flex justify-end uppercase font-semibold text-base tracking-[-0.04em] ">(SOBRE NOSOTROS)</p>
    </div>
    <div class="mx-auto max-w-7xl px-4 flex flex-col items-center justify-center p-4">
      <img src="{% static 'core/img/foto-playa-home.jpg' %}" alt="" class="w-full md:max-w-[40%]">
      <p class="mt-3 text-black font-medium text-md md:text-xl max-w-[60%] md:max-w-[40%] tracking-[-0.04em]">Nuestro compromiso de hospedar a personas comenzo con 
        nuestro padre cuando decidi√≥ invertir el dinero que generaba vendiendo frutas y 
        verduras en un terreno y construyendo una bodega de almacenamiento, el tiempo fue 
        pasando y con √©l la evoluci√≥n de las bodegas pasaron de ser 1 a 3.
      </p>
      <p class="mt-3 text-black font-medium text-ml md:text-xl max-w-[60%] md:max-w-[40%] tracking-[-0.04em] pt-2">
        Posteriormente 
        inici√≥ construyendo apartamentos encima de ellos, con el paso de los a√±os fue aumentando 
        el n√∫mero de apartamentos y de casas. Muchas cosas cambiaron desde aquellos a√±os, pero lo que nunca cambiar√° es
        el compromiso familiar y de trabajadores para ofrecer el mejor servicio y que nuestros clientes se sientan como en casa.
      </p>
      <p class="m-0 text-xl sm:text-2xl font-semibold tracking-tight mt-6">
        <a href="{% url 'property_list' %}" class="group inline-block align-top">
          <!-- Clip de 1 l√≠nea -->
          <span class="relative block overflow-hidden h-[1em] leading-[1]">
            <!-- Cinta de 2 l√≠neas; al hover sube 1 l√≠nea -->
            <span class="block transform-gpu transition-transform duration-300 ease-[cubic-bezier(.2,.7,0,1)]
                        group-hover:-translate-y-1/2">
              <span class="block italic">VER PROPIEDADES</span>
              <span class="block" aria-hidden="true">VER PROPIEDADES</span>
            </span>
          </span>
        </a>
      </p>
    </div>
  </section>
{% endblock %}
{% block chatbot %}
  <!-- Chatbot minimal con bot√≥n flotante -->
  <style>
    .bot-fab, .bot-panel { z-index: 9999; }
    .bot-fab{position:fixed;right:20px;bottom:20px;width:56px;height:56px;border-radius:50%;border:none;cursor:pointer;box-shadow:0 8px 20px rgba(0,0,0,.15);font-size:24px}
    .bot-panel{position:fixed;right:20px;bottom:84px;width:320px;max-height:420px;background:#fff;border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.12);display:none;overflow:hidden}
    .bot-header{padding:10px 14px;font-weight:600;border-bottom:1px solid #eee}
    .bot-msgs{height:300px;overflow:auto;display:flex;flex-direction:column;gap:10px;padding:12px;background:#fafafa}
    .bot-bubble{max-width:80%;padding:8px 10px;border-radius:12px;line-height:1.3;word-wrap:break-word;white-space:pre-wrap}
    .bot-user{align-self:flex-end;background:#e0f2fe}
    .bot-assistant{align-self:flex-start;background:#f1f5f9}
    .bot-typing{font-size:12px;color:#64748b;margin:0 8px}
    .bot-input{display:flex;border-top:1px solid #eee}
    .bot-input input{flex:1;border:0;padding:12px;outline:none}
    .bot-input button{border:0;padding:0 14px;cursor:pointer}
  </style>

  <div id="bot-panel" class="bot-panel" aria-live="polite">
    <div class="bot-header">Asistente</div>
    <div id="bot-msgs" class="bot-msgs"></div>
    <form id="bot-form" class="bot-input">
      <input id="bot-input" autocomplete="off" placeholder="Escribe tu pregunta..." />
      <button type="submit">Enviar</button>
    </form>
  </div>
  <button id="bot-fab" class="bot-fab" aria-label="Abrir chat">üí¨</button>
{% endblock chatbot %}
{% block body_extra %}
    <script>
    // Utilidades de fecha
    const addDays = (d, n) => {
        const x = new Date(d.getFullYear(), d.getMonth(), d.getDate());
        x.setDate(x.getDate() + n);
        return x;
    };
    const fmt = d => d.toISOString().slice(0,10); // YYYY-MM-DD

    const $in  = document.getElementById("id_checkin");
    const $out = document.getElementById("id_checkout");

    // Flatpickr en espa√±ol
    const fpIn = flatpickr($in, {
        dateFormat: "Y-m-d",
        minDate: "today",
        locale: "es",
        onChange: function(selectedDates) {
        if (!selectedDates.length) return;
        const checkin = selectedDates[0];
        const minOut = addDays(checkin, 2); // m√≠nimo 2 noches
        fpOut.set("minDate", minOut);

        // Si checkout vac√≠o o menor que minOut, lo auto-ajustamos
        const currentOut = fpOut.selectedDates[0];
        if (!currentOut || currentOut < minOut) {
            fpOut.setDate(minOut, true); // true = dispara onChange
        }
        },
    });

    const fpOut = flatpickr($out, {
        dateFormat: "Y-m-d",
        minDate: "today",
        locale: "es",
    });
    </script>
{% endblock %}
